<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Админка • Онлайн-запись</title>
  <link rel="stylesheet" href="admin.css">
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=Playfair+Display:wght@600;700&display=swap" rel="stylesheet">
</head>
<body>

<div style="position:fixed;top:24px;right:24px;z-index:1000;">
  <button class="btn btn-danger" id="logout-btn">Выйти</button>
</div>

<div class="container">
  <header class="text-center mb-40">
    <h1 id="page-title">Онлайн-запись</h1>
    <p id="page-subtitle" style="font-size:1.4rem;color:var(--text-light);">Админ-панель • Полный контроль</p>
    <div id="master-badge" style="display:none;margin-top:20px;background:var(--accent);color:white;padding:12px 32px;border-radius:50px;font-weight:600;font-size:1.2rem;">
      Мастер: <span id="master-name-display"></span>
    </div>
  </header>

  <!-- УСЛУГИ -->
  <div class="card" id="services-card">
    <h2>Услуги</h2>
    <button class="btn" onclick="openModal('service-modal')">+ Добавить услугу</button>
    <div id="services-list" class="grid mt-20"></div>
  </div>
  <!-- Блок горизонта записи -->
<div class="card" id="booking-horizon-card">
  <h2>Горизонт записи</h2>
  <p style="color: var(--text-light); margin-bottom: 24px;">
    На сколько дней вперёд клиенты могут бронировать
  </p>

  <div style="display: flex; gap: 16px; align-items: center; flex-wrap: wrap;">
    <input type="number" id="maxBookingDaysAhead" class="input" 
           min="7" max="365" step="1" placeholder="90" 
           style="width: 140px;" />

    <span style="font-size: 1.1rem;">дней вперёд</span>

    <button class="btn" onclick="saveBookingHorizon()">Сохранить</button>
  </div>

  <div id="horizon-preview" style="margin-top: 16px; font-style: italic; color: var(--text-light);">
    Сейчас открыта запись до: <span id="horizon-date">...</span>
  </div>
</div>
  
  <!-- МАСТЕРА -->
  <div class="card" id="masters-card">
    <h2>Мастера</h2>
    <button class="btn" onclick="openMasterModal()">+ Добавить мастера</button>
    <div id="masters-list" class="grid mt-20"></div>
  </div>

  <!-- ЗАПИСИ -->
 <!-- ЗАПИСИ -->
<div class="card" id="bookings-card">
  <h2>Записи</h2>
  
  <!-- Вкладки -->
  <div class="tabs" style="display:flex;gap:12px;margin-bottom:20px;">
    <button class="btn" onclick="switchTab('all')" id="tab-all">Все</button>
    <button class="btn" onclick="switchTab('today')" id="tab-today">Сегодня</button>
    <button class="btn" onclick="switchTab('month')" id="tab-month">Месяц</button>
    <button class="btn" onclick="switchTab('history')" id="tab-history">История</button>
  </div>

  <!-- Фильтры -->
  <div style="display:flex;gap:16px;align-items:flex-end;margin-bottom:24px;">
    <form autocomplete="off" style="display:contents;"><input type="text" class="input" id="search" placeholder="Поиск по имени, телефону или услуге..." autocomplete="off" name="search-field-dont-autofill"></form>
    <input type="date" class="input" id="filter-date" style="width:180px;">
    <select class="input" id="filter-master" style="width:200px;">
      <option value="">Все мастера</option>
      <!-- Заполняется JS -->
    </select>
    <button class="btn" onclick="applyFilters()">Применить</button>
    <button class="btn btn-warning" onclick="clearFilters()">Очистить</button>
  </div>

  <p style="color:var(--text-light);margin-bottom:16px;">
    Всего записей: <span id="count">0</span>
  </p>

  <div id="bookings-list" class="grid mt-20"></div>

  <div style="display:flex;gap:12px;margin-top:32px;">
    <button class="btn btn-danger" id="delete-selected" disabled onclick="deleteSelectedBookings()">Удалить выбранные</button>
    <button class="btn btn-warning" id="transfer-selected" disabled onclick="transferSelectedBookings()">Массовый перенос</button>
  </div>
</div>

  <!-- КАЛЕНДАРЬ БЛОКИРОВКИ -->
  <div class="card">
    <h2>Блокировка времени</h2>
    <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:24px;">
      <button class="btn" id="prevMonthBlock">← Предыдущий</button>
      <h3 id="currentMonthBlock" style="margin:0;"></h3>
      <button class="btn" id="nextMonthBlock">Следующий →</button>
    </div>
    <div id="block-calendar" style="display:grid;grid-template-columns:repeat(7,1fr);gap:12px;"></div>
  </div>
</div>

<!-- МОДАЛКИ -->
<div id="service-modal" class="modal">
  <div class="modal-content">
    <span class="close" onclick="closeModal('service-modal')">×</span>
    <h2 id="service-modal-title">Добавить / Редактировать услугу</h2>

    <input id="service-name" class="input" placeholder="Название услуги" required>
    <input id="service-price" class="input" placeholder="Цена (₽)" type="number" min="0">
    <input id="service-duration" class="input" placeholder="Длительность (мин)" type="number" min="1">
    <textarea id="service-desc" class="input" placeholder="Описание (опционально)" rows="4"></textarea>

    <div style="display: flex; gap: 16px; margin-top: 24px;">
      <button class="btn" onclick="saveService()">Сохранить</button>
      
      <!-- Кнопка удаления — показывается только при редактировании -->
      <button id="delete-service-btn" 
              class="btn btn-danger" 
              style="display:none;" 
              onclick="deleteService()">
        Удалить услугу
      </button>
    </div>
  </div>
</div>

<div id="master-modal" class="modal">
  <div class="modal-content">
    <span class="close" onclick="closeModal('master-modal')">×</span>
    <h2 id="master-modal-title">Добавить / Редактировать мастера</h2>

    <input id="master-name" class="input" placeholder="Имя мастера" required>
    <input id="master-email" class="input" placeholder="Email" type="email" required>
    <input id="master-password" class="input" placeholder="Пароль (для нового — обязательно)" type="password">
    <input id="master-photo" class="input" placeholder="URL фото (опционально)">

    <div style="display: flex; gap: 16px; margin-top: 24px;">
      <button class="btn" onclick="saveMaster()">Сохранить</button>
      
      <!-- Кнопка удаления — показываем только при редактировании -->
      <button id="delete-master-btn" 
              class="btn btn-danger" 
              style="display:none;" 
              onclick="deleteMaster()">
        Удалить мастера
      </button>
    </div>
  </div>
</div>

<div id="booking-modal" class="modal">
  <div class="modal-content">
    <span class="close" onclick="closeModal('booking-modal')">×</span>
    <h2 style="color:var(--accent);">Редактировать запись</h2>
    <div style="background:#f9f5f3;padding:20px;border-radius:16px;margin-bottom:20px;">
      <p><strong>Клиент:</strong> <span id="booking-client-name"></span></p>
      <p><strong>Телефон:</strong> <span id="booking-client-phone"></span></p>
      <p><strong>Услуга:</strong> <span id="booking-service-name"></span></p>
    </div>
    <div style="display:grid;gap:16px;">
      <div>
        <label style="display:block;margin-bottom:8px;font-weight:600;">Новая дата</label>
        <input type="date" class="input" id="new-booking-date">
      </div>
      <div>
        <label style="display:block;margin-bottom:8px;font-weight:600;">Новое время</label>
        <select class="input" id="new-booking-time" style="height:56px;">
          <option value="10:00">10:00</option>
          <option value="11:00">11:00</option>
          <option value="12:00">12:00</option>
          <option value="13:00">13:00</option>
          <option value="14:00">14:00</option>
          <option value="15:00">15:00</option>
          <option value="16:00">16:00</option>
          <option value="17:00">17:00</option>
          <option value="18:00">18:00</option>
          <option value="19:00">19:00</option>
          <option value="20:00">20:00</option>
          <option value="21:00">21:00</option>
        </select>
      </div>
    </div>
    <div style="display:flex;gap:12px;margin-top:24px;">
      <button class="btn" onclick="transferBooking()">Перенести</button>
      <button class="btn btn-danger" onclick="cancelBooking()">Отменить запись</button>
    </div>
    <button onclick="closeModal('booking-modal')" style="margin-top:12px;width:100%;padding:16px;background:#666;color:white;border:none;border-radius:20px;">
      Закрыть
    </button>
  </div>
</div>

<script type="module" src="firebase-config.js"></script>
<script type="module" src="./src/admin-toast.js"></script>
<script type="module" src="admin.js"></script>
</body>
</html>